# Remix-Docker
## Remix & Hono on Docker: Full-Stack Template

このリポジトリは、**Remix** (フロントエンド)、**Hono** (バックエンドAPI)、**PostgreSQL** (データベース)、そして **Prisma** (ORM) を使用したフルスタックのWebアプリケーションを、**Docker** を使って構築するためのテンプレートです。

開発環境と本番環境が明確に分離されており、それぞれの用途に最適化された構成になっています。

---

## ✨ 主な特徴

* **🐳 Dockerによる環境分離**: `docker-compose` を利用して、開発環境と本番環境をコマンド一つで切り替えられます。
* **🔄 型安全な開発フロー**: PrismaによるDBマイグレーションと型生成を自動化。Docker Volumeを通じて型情報をフロントエンドとバックエンドで共有し、一貫性のある安全な開発を実現します。
* **🌿 開発のしやすさ**: 開発環境ではホットリロードが有効。コードの変更が即座に反映され、ストレスなく開発に集中できます。
* **🚀 本番を想定した構成**: 本番環境では不要なポートを閉じ、リバースプロキシ(Caddyなど)経由でのアクセスを前提としたセキュアなネットワーク構成を採用しています。

---

## 🏢 アーキテクチャと型情報の流れ

このプロジェクトは、各役割に特化したコンテナ群で構成されています。

1.  **`orm` コンテナの役割**
    `orm` コンテナは起動時に以下の処理を自動的に実行します。
  * `prisma migrate`: データベースのテーブル構造を最新の状態に更新します。
  * `prisma generate`: DBスキーマに基づき、TypeScriptの型定義ファイル (Prisma Client) を生成します。

2.  **Docker Volumeによる型情報の共有**
    生成されたPrisma Clientは `prisma_client_volume` というDocker Volumeに保存されます。

3.  **各サービスでの型利用**
    `remix` (フロントエンド) と `api` (バックエンド) のコンテナがこのVolumeを読み取り専用でマウントします。これにより、プロジェクト全体で常に最新かつ一貫したデータ型を利用でき、開発効率と安全性が向上します。

---

## 🛠️ 開発環境 vs 本番環境

`Makefile` に定義されたコマンドで、2つの環境を簡単に管理できます。

### 🌿 開発環境 (`make up-dev`)

開発のしやすさを最優先した構成です。

* **ホットリロード**: ソースコードの変更が即座にアプリケーションに反映されます。
* **ポートフォワーディング**: 各サービスにローカルマシンから直接アクセスできます。
  * **Webサイト**: `http://localhost:5173`
  * **バックエンドAPI**: `http://localhost:3000`
  * **DB管理画面 (Prisma Studio)**: `http://localhost:5555`

### 🚀 本番環境 (`make up-prod`)

セキュリティと安定性を重視した構成です。

* **ポート非公開**: コンテナは外部に直接ポートを公開しません。意図しないアクセスを遮断し、セキュリティを高めます。
* **リバースプロキシ連携**: **Caddy** などのリバースプロキシサーバーを介してのみ、Webサイトに安全にアクセスすることを想定しています。
* **自動再起動**: コンテナが予期せず停止した場合でも、自動で再起動 (`restart: unless-stopped`) し、サービスの可用性を高めます。

---

## ▶️ 使い方 (Makefileコマンド)

| コマンド | 説明 |
| :--- | :--- |
| `make up-dev` | 開発用のコンテナを起動します。 |
| `make down-dev` | 開発用のコンテナを停止します。 |
| `make logs-dev` | 開発用コンテナのログを表示します。 |
| `make ps-dev` | 開発用コンテナの状態を確認します。 |
| | |
| `make up-prod` | 本番用のコンテナを起動します。 |
| `make down-prod` | 本番用のコンテナを停止します。 |
| `make build-prod` | 本番用のDockerイメージをビルドします。 |
| `make migrate-prod` | 本番データベースのマイグレーションを実行します。 |
